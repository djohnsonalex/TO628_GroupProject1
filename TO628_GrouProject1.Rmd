---
title: 'Group Project #1: Prosper'
author: "Team: RTeam.Is.Better.Than.Yours = TRUE" 
date: "3/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Initial Data Exploration
Before diving into our regression analysis, we reviewed the data to understand its structure and the nature of the information.  From our cursory review, we were able to determine a few things: our data has 33,542 observations, 51 different variables, and is fortunately fairly clean.  Only the variable installment_balance has NA's, with 153.

```{r}
#Loading data
loandata = read.csv("ProjectA_Listings2013.csv")

#Exploring data
str(loandata)

summary(loandata)

```

Based on the initial exploration, we need to perform data cleansing to make the dataset ready for analysis, including addressing the NAs and removing non-numeric / non-categorical columns, or categorical columns with too many factors to be useful (e.g., city).  We also change categorical variables to factor data types. 

```{r}
#Determining column numbers 
colnames(loandata)

#Changing certain variables to factors
loandata$prosper_rating = as.factor(loandata$prosper_rating)
loandata$scorex = as.factor(loandata$scorex)
loandata$employment_status_description = as.factor(loandata$employment_status_description)

#Removing non-factor description or text columns
loandata_clean = loandata[, -c(4,5,15,20,22,23,30)]

#Replacing N/As in installment_balance with zeros
loandata_clean[is.na(loandata_clean)] = 0

str(loandata_clean)
summary(loandata_clean)
```



## Linear Regression
Given our data has 51 variables, we ultimately want to determine the most salient variables to use, but to begin, we perform a regression of borrower_rate against all variables.  This will tell us right now which variables are most significant in determining a borrower's interest rate. 

```{r}

lin_reg_all = lm(borrower_rate ~., data = loandata_clean)
summary(lin_reg_all)
```
We can next remove all the insignificant variables and re-run the regression. 

```{r}
#Re-running regression with only significant variables from previous regression
lin_reg_sigonly = lm(borrower_rate ~ number_of_days + principal_balance + loan_status + amount_funded + prosper_rating +
                       listing_term + listing_monthly_payment + scorex + prosper_score + listing_category_id + stated_monthly_income
                     + employment_status_description + lender_indicator + monthly_debt + inquiries_last6_months + amount_delinquent 
                     + current_credit_lines + open_credit_lines + total_open_revolving_accounts + total_inquiries + delinquencies_over30_days + is_homeowner, data = loandata_clean)

summary(lin_reg_sigonly)

```

Based on our generalized linear model, the significant predictors of borrower_rate are:
`r names(coef(lin_reg_sigonly))`


## Logistic Regression
To set up logistic regression, we need to convert the dependent variable to a boolean to reflect the fact that logistic regression deals with binary outcomes.  We began the analysis by regressing the default yes/no variable with all variables.  Several of these variables were insignificant and we removed insignificant variables until only significant variables remained.  

```{r}

default <- ifelse(loandata_clean$loan_status == "3",1,0)
loandata_clean$default <- default
str(loandata_clean)

log_reg = glm(default ~ . , family = "binomial", data = loandata_clean)
summary(log_reg)

log_reg_2 = glm(default ~  number_of_days + principal_balance + borrower_rate
                + listing_term + income_range + monthly_debt 
                + bankcard_utilization + total_inquiries, family = "binomial", data = loandata_clean)
summary(log_reg_2)

log_reg_3 = glm(default ~  number_of_days + borrower_rate
                + listing_term + income_range + monthly_debt 
                + total_inquiries, family = "binomial", data = loandata_clean)
summary(log_reg_3)

```

Based on our logistic regression model, the significant predictors of default are:
`r names(coef(log_reg_3))`

## Analysis of Arbitrage Oppurtunities 
Based on our linear and logistic regression models, some variables used to determine borrower rate have little impact on default probability. These include: 
1. Employment status
2. Credit score
3. Amount funded

Potential borrowers who have non-full time jobs, lower credit scores, or need a higher funding amount may have been pushed away by being offered loans with high interest rates.  The fact that these variables do not lead to default gives a Prosper a business opportunities to grow their share with these segments of the population, given that they know these variables have limited impact on default probabilities.  Additionally, since higher interest rates are associated with defaults, by reducing interest rates in these populations, defaults could be expected to be even lower. 

On the other hand, income_range is not a significant  factor to determine interest rate, but has a significant impact on predicting defaults, with a higher income range associated with lower probabilities of default.  Prosper should likely begin using income_range as a larger factor in determining borrower interest rates.   
